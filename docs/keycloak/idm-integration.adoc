= Keycloak+IdM Integration for User Federation

== Integration

=== Access Keycloak UI Admin Console

* Open a web browser and enter the following URL

`https://keycloak-keycloak.apps.tssc.rht-set.com/auth/admin/`

* Enter Admin Username: `keycloak`
* Enter Admin Password: `<password>`

=== Configure User Federation

* Select "User Federation" on the left menu
* Select "Add provider" dropdown & select "ldap"
* Input the following configurations:
** Console Display Name: `ldap-IdM`
** Vendor: `Red Hat Directory Server`
** Connection URL: `ldap://idm-3.tssc.rht-set.com`
** Users DN: `cn=users,cn=accounts,dc=tssc,dc=rht-set,dc=com`
** Bind Type:  `simple`
** Bind DN: `uid=admin,cn=users,cn=compat,dc=tssc,dc=rht-set,dc=com`
** Bind Credential: `<password>`
** Periodic Full Sync:  `On`
** Periodic Changed Users Sync: `On`
* Select "Save"
* Validate connection
** Select "Test connection"
** Select "Test authentication"
* Select "Synchoronize all users"

== Migration

=== Access IdM UI Admin Console
* Open a web browser and enter the following URL
`https://idm-1.tssc.rht-set.com/ipa/ui`
* Enter Admin Username: `admin`
* Enter Admin Password: `<password>`

=== Create IdM Users
* Select "Users" 
* Selectg "+Add"
* Input the following configuration:
** User login: <username> (8 characters)
** First Name:  User
** Last Name: Name
** New Password: <password> 
** Verify Password; <password>
* Select "Add"
* Repeat if necessary

=== Access Keycloak UI Admin Console

* Open a web browser and enter the following URL

`https://keycloak-keycloak.apps.tssc.rht-set.com/auth/admin/`

* Enter Admin Username: `keycloak`
* Enter Admin Password: `<password>`

=== Delete Keycloak Identities
If you setup local user account in keycloak and want to use those same names in IdM delete the accounts.

* Select "Users" on the left menu
* Select "View all users"
* Select "Delete" for the user you wish to delete & again for the confirmation

=== Delete OCP Identities
If you logged in with any of the keycloak users to your OCP cluster you need to delete these identities

* Login to OCP
`oc login -u kubeadmin`
* Get User List
`oc get users`
* Delete Users
`oc delete username`
* Validate Users Are Delete`
`oc get users`

=== Access Keycloak UI Admin Console

* Open a web browser and enter the following URL

`https://keycloak-keycloak.apps.tssc.rht-set.com/auth/admin/`

* Enter Admin Username: `keycloak`
* Enter Admin Password: `<password>`

=== Sync IdM Users

* Select "User Federation" on the left menu
* Select "ldap-IdM"
* Select "Synchoronize all users"
* Validate User Sync
** Select "Users"
** Select "View all users"


